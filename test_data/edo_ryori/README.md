# 江戸料理レシピスクレイピングツール

このツールは、CODH（人文学オープンデータ共同利用センター）の「江戸料理レシピデータセット」から歴史的な日本料理レシピをスクレイピングし、構造化されたデータとして出力するためのPythonスクリプトです。

**最終動作確認日**: 2025年8月19日

⚠️ **重要な注意事項**: このツールはウェブスクレイピングに依存しているため、CODH側のWebサイト構造変更により動作しなくなる可能性があります。定期的な動作確認とメンテナンスが必要です。

## 概要

江戸時代の料理書『万宝料理秘密箱 卵百珍』に収録された107のレシピを対象として、以下の情報を抽出・整理します：

- **翻刻テキスト**：江戸時代の原文
- **現代語訳**：現代日本語への翻訳
- **現代レシピ**：現代風にアレンジされたレシピ（材料・手順・コツ）

## 機能

### データ抽出
- レシピ名・URL
- 翻刻テキスト（原文）
- 現代語訳
- 現代レシピ（説明・材料・手順・コツ）
- 各種手順の分離（現代レシピ手順・現代語訳手順・翻刻テキスト手順）

### 出力形式
- **JSON形式**：構造化データとして
- **CSV形式**：表形式のデータとして

### 実行オプション
- レシピ数のカウント表示
- 取得レシピ数の指定
- 特定レシピの個別取得
- サーバー負荷軽減のためのスリープ時間設定
- カスタム出力ファイル名

## インストール

### 必要な環境
- Python 3.7以降
- 仮想環境（推奨）

### 依存関係のインストール
```bash
# 仮想環境の作成・有効化
python -m venv venv
source venv/bin/activate  # Linux/Mac
# または
venv\Scripts\activate     # Windows

# 依存パッケージのインストール
pip install requests beautifulsoup4 pandas
```

## 使用方法

### 基本的な使用方法

```bash
# レシピ数のみを表示
python scrape_test.py --count-only

# デフォルト（5件）のレシピを取得
python scrape_test.py

# 全レシピを取得
python scrape_test.py --num-recipes 0

# 10件のレシピを取得
python scrape_test.py --num-recipes 10

# 特定のレシピ（例：6番）のみを取得
python scrape_test.py --get-recipe 6

# サーバー負荷を考慮して2秒間隔で取得
python scrape_test.py --num-recipes 10 --sleep-time 2.0

# カスタムファイル名で出力
python scrape_test.py --num-recipes 5 --output my_recipes
```

### コマンドラインオプション

| オプション | 説明 | デフォルト値 |
|------------|------|--------------|
| `--count-only` | レシピ数のみを表示して終了 | False |
| `--num-recipes N` | 取得するレシピ数を指定（0で全件） | 5 |
| `--get-recipe N` | 指定番号のレシピのみを取得 | なし |
| `--sleep-time N` | HTTP取得前のスリープ時間（秒） | 1.0 |
| `--output NAME` | 出力ファイル名のベース | edo_recipes |

### 制限事項

- `--get-recipe`と`--num-recipes`は同時指定できません
- `--get-recipe`を使用する場合、`--num-recipes`はデフォルト値（5）のままにしてください

## 出力データ構造

### JSON形式
```json
[
  {
    "id": "1",
    "name": "金糸卵",
    "url": "https://codh.rois.ac.jp/edo-cooking/tamago-hyakuchin/recipe/001.html.ja",
    "original_text": ["手順", "1卵の白味をとり　半紙にて漉し..."],
    "modern_translation": ["手順", "1生卵の白身を半紙で濾す。..."],
    "modern_recipe": {
      "description": ["旨味濃厚！ウニの金糸卵", "考案：三ツ星たまごソムリエ友加里"],
      "ingredients": ["卵白: 2個", "瓶詰めうに: 小さじ1"],
      "modern_instructions": ["1: 卵白とウニをフードプロセッサーに入れる。"],
      "tips": "クックパッド江戸ご飯のレシピ"
    },
    "modern_translation_instructions": ["1: 生卵の白身を半紙で濾す。"],
    "original_instructions": ["1: 卵の白味をとり　半紙にて漉し"],
    "usage": "",
    "tools": "",
    "raw_content": "..."
  }
]
```

### CSV形式
フラット化されたデータ構造で、各配列は`;`区切りの文字列として格納されます。

## データセットの制限事項

### 重要な注意事項
CODHの江戸料理データセットには以下の制限があります：

1. **翻刻テキスト**: 全107レシピに存在
2. **現代語訳・現代レシピ**: 一部のレシピ（約42件、39.3%）のみに存在

### 現代レシピが存在しないレシピ
以下のレシピIDでは現代レシピデータが提供されていません：
```
9, 10, 11, 13, 14, 21, 22, 26, 27, 28, 33, 34, 37, 38, 39, 41, 42, 43, 44, 48, 49, 50, 51, 52, 54, 55, 56, 57, 58, 59, 60, 61, 63, 64, 67, 68, 69, 70, 71, 72, 74, 75, 76, 77, 79, 81, 82, 84, 87, 89, 90, 91, 92, 93, 94, 95, 97, 98, 99, 100, 101, 102, 105, 106, 107
```

これらのレシピでは以下のフィールドが空になります：
- `modern_translation`
- `modern_recipe.description`
- `modern_recipe.ingredients`
- `modern_recipe.modern_instructions`
- `modern_translation_instructions`

## トラブルシューティング

### よくある問題

1. **レシピが0件取得される**
   - ネットワーク接続を確認してください
   - CODHサーバーの可用性を確認してください

2. **特定のレシピで現代レシピが空**
   - データセットの制限事項です（上記参照）
   - 翻刻テキストは正常に取得されているはずです

3. **取得が遅い**
   - `--sleep-time`を調整してください（推奨：1-3秒）
   - サーバーへの負荷を考慮した適切な間隔を設定してください

### デバッグ用コマンド

```bash
# 特定レシピの詳細確認
python scrape_test.py --get-recipe 6

# 少数のレシピでテスト
python scrape_test.py --num-recipes 3 --sleep-time 2
```

## データの利用について

### ライセンス
抽出されたデータは、CODHの「江戸料理レシピデータセット」に基づいており、以下のライセンスの下で提供されています：

- **ライセンス**: クリエイティブ・コモンズ 表示 - 継承 4.0 国際 ライセンス（CC BY-SA）
- **出典表示**: 『江戸料理レシピデータセット』（CODH作成） 『日本古典籍データセット』（国文研所蔵）を翻案

### 推奨される利用方法
- 学術研究
- 歴史的料理の復元・研究
- 文化的データの分析
- 教育目的での利用

## 技術仕様

### 主要な技術スタック
- **Python 3.7+**
- **requests**: HTTP通信
- **BeautifulSoup4**: HTMLパース
- **pandas**: データ処理・CSV出力
- **argparse**: コマンドライン引数処理

### アーキテクチャ
- `EdoRecipeScraper`クラス：メインのスクレイピングロジック
- モジュール設計：各機能が独立したメソッドに分離
- エラーハンドリング：ネットワークエラーやパースエラーに対応

## 開発者向け情報

### コード構成
```
edo_ryori/
├── scrape_test.py      # メインスクリプト
├── README.md           # このファイル
├── CLAUDE.md          # 開発・保守用ドキュメント
├── venv/              # Python仮想環境
└── output files:
    ├── edo_recipes.json
    ├── edo_recipes.csv
    └── edo_recipes_all.json
```

### 主要クラス・メソッド
- `EdoRecipeScraper.__init__(sleep_time=1)`: 初期化
- `get_recipe_list()`: レシピ一覧の取得
- `scrape_recipe_detail(recipe_info)`: 個別レシピの詳細取得
- `scrape_recipes(num_recipes=None)`: 複数レシピの取得
- `scrape_single_recipe(recipe_number)`: 単一レシピの取得

## 貢献・改善

このツールの改善提案やバグ報告は歓迎します。特に以下の分野での貢献を求めています：

1. HTMLパース精度の向上
2. エラーハンドリングの強化
3. 新しい出力形式のサポート
4. パフォーマンス最適化

## 免責事項

- このツールは研究・教育目的で作成されています
- CODHサーバーへの過度な負荷を避けるため、適切なスリープ時間を設定してください
- データの正確性について、作者は責任を負いません
- 商用利用前には、CODHのライセンス条項を確認してください
- **ウェブスクレイピングの性質上、対象サイトの構造変更により予告なく動作しなくなる場合があります**
- 動作しない場合は、最新の動作確認日以降にサイト変更があった可能性を考慮してください